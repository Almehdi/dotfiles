#!/bin/zsh

## Where the files are located
file_dir="$HOME/.cache/rtorrent/incomplete/"

sleep 2

echo "$(date +'[%y%m%d-%T]')" >> rtorrent.log
echo "1:$1\n" >> rtorrent.log

## Move movie files to root incomplete dir if they are in a folder
if [ $(grep -o "\[.*\]" <<<$1) ]; then
	mv $file_dir/*\[*\]/*.mkv $file_dir
	1=$(sed 's/\[.*\]//' <<<$file_dir$(basename $1.mkv))
	rm -drf $file_dir/*\[*\]/
fi

echo "2:$1\n" >> rtorrent.log

sleep 2

## Move files to ~/Documents, ~/Videos or ~/Downloads depending on file extension
if [ $(grep -iE '*.[Dd][Oo][Cc]|[Pp][Dd][Ff]|[Oo][Dd][Tt]|[Tt][Xx][Tt]' <<<"$1") ]; then
	mv -u $1 ~/Documents
	ln -s ~/Documents/$(basename $1) $1
	exit 0
elif [ $(grep -iE '*.[Aa][Vv][Ii]|[Mm][Pp]4|[Mm][Kk][Vv]|[Mm][Pp][Gg]|[Mm][Pp][Ee][Gg]|[Ff][Ll][Vv]' <<<"$1") ]; then
	mv -u $1 ~/Videos
	ln -s ~/Videos/$(basename $1) $1
	exit 0
else
	mv -u $1 ~/Downloads;ln -s ~/Downloads/$(basename $1) $1
	exit 0
fi
