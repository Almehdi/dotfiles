#!/bin/bash

old_ifs=$IFS
IFS=$'\012' 


git_init() {

	printf "This will create a directory where you will\nstore your dotfiles\n\n"

	read -p "Enter dotfile directory: " dotfile_home

	[[ ! -d $dotfile_home ]] && { 
		echo "creating dir"
		mkdir -p $dotfile_home 
		echo "$dotfile_home" > $HOME/.config/mkdotfile
		break
	} || { 
		echo "\n\nDirectory already exist"
	}

        cd $(< "$HOME/.config/mkdotfile")
	read -p "Enter git repository url: " dotfile_home

} 

git_push() {
	[[ ! -e "$HOME/.config/mkdotfile" ]] && {
		printf "\nMissing file. You probably need to\ndo a init first\n\n"
		exit 1 
	}
	
	cd $(< "$HOME/.config/mkdotfile") 
	git add -A
	git status
	echo
	read -p "Enter your commit message: " git_commit 

	git commit -m "$git_commit"  
	git push
	break
}

while true; 
do
	case $1 in
		push) git_push ;;
		init) git_init ;;
		*) echo "No valid option (init|push) entered... closing."; exit 1 ;;
	esac
done

IFS=$old_ifs
